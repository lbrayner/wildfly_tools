#!/bin/sh

print_usage() {
	printf '\n%s\n' "$(basename "${0}") [WILDFLY_HOME]"
}

if [ ${#} -gt 1 ]
then
    print_usage 1>&2
    exit 1
fi

wildfly=""

if [ ${#} -eq 1 ]
then
    wildfly="${1}"
fi

if [ -z "${wildfly}" ]
then
    wildfly="${WILDFLY_HOME}"
fi

if [ -z "${wildfly}" ]
then
    print_usage 1>&2
    exit 1
fi

deployments="${wildfly}"/standalone/deployments

rm ${deployments}/*.dodeploy* 2>/dev/null 1>/dev/null
rm ${deployments}/*.undeploy* 2>/dev/null 1>/dev/null
rm ${deployments}/*.deployed* 2>/dev/null 1>/dev/null
rm ${deployments}/*.isdeploy* 2>/dev/null 1>/dev/null
rm ${deployments}/*.failed*   2>/dev/null 1>/dev/null

find ${deployments}/ -mindepth 1 -maxdepth 1 -exec basename "{}" \; \
    | xargs  -L1 -i touch ${deployments}/"{}".dodeploy
